trigger:
  branches:
    include:
    - '*'

variables:
- name: unregister.opt-in
  value: true

resources:
  repositories:
    - repository: azdo_templates
      type: github
      name: relativityone/azdo-templates
      endpoint: relativityone
      ref: 'refs/heads/main'

stages:
- template: rapci-server.yml@azdo_templates  # Template reference
  parameters:
    RelativityBranch: ''
    TemplateName: 'aio-server-2023-ga'
    buildSteps:
      - script: choco install microsoft-build-tools -y
        displayName: 'Install MSBuild'

      - task: MSBuild@1
        inputs:
          solution: '**/*.sln'
          targets: 'Clean'
          verbosity: 'normal'

      - checkout: self
      - checkout: azdo_templates

      - task: NuGetCommand@2
        inputs:
          command: 'restore'
          restoreSolution: '**/*.sln'
          feedsToUse: 'config'
          nugetConfigPath: '$(Pipeline.Workspace)/NuGet.config'

      - script: 'msbuild /v:detailed'
        displayName: 'Build Solution'