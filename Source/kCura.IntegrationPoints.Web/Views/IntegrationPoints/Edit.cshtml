@using System.Text.RegularExpressions
@model kCura.IntegrationPoints.Web.Models.EditPoint

@section header{
	<div class="header-actions-container">
		<div style="position:absolute; right:70px"><button class="button secondary positive" id="cancel">Cancel</button></div>

		<div class="tooltip bottom" data-title="Help" style="position:absolute; right:40px">
			<span class="legal-hold icon-help"> </span>
		</div>
	</div>
	<h1>Create @Model.ArtifactTypeName</h1>
}

@*TODO: This is needed to style the Preview buttons that we place on the partial view with the RIP steps*@
@* Once the button location is finalized with UX, we may find a better place for this reference or pull out Preview button styles into own css file*@
<link href="~/Content/import.css" rel="stylesheet" />

<div id="processingLocationErrorContainer"></div>

<div class="card ">
	<div class="table full-width">
		<div class="cell" id="stepProgress"></div>
		<div class="cell v-align h-align" id="progressButtons">
			<button class="button generic positive" id="back"><i class="icon-left-arrow"></i>Back</button>
			<button class="button generic positive" id="next">Next<i class="icon-right-arrow"></i></button>
			<button class="button generic positive" id="save" style="display: none;"><i></i>Save</button>
		</div>
	</div>
</div>

<div id="pointBody" data-bind="template: { name: 'currentTmpl', data: currentStep }"></div>

<script id="currentTmpl" type="text/html">
	<div data-bind="template: { name: template(), data: model }"></div>
</script>

@section scripts
{
	@*User-Agent of IE11 is 
		'"Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727; .NET CLR 3.0.30729; .NET CLR 3.5.30729; InfoPath.3; rv:11.0) like Gecko"'
		If Request.UserAgent matches regular expression then we render shims that provider ES6 features backwards compatibility.
		We don't check other IE versions because IE11 is only one supported now.
	*@
	@if (Regex.IsMatch(Request.UserAgent, @"Trident/7.*rv:11"))
	{
		<script src="~/Scripts/es5-shim.min.js"></script>
		<script src="~/Scripts/es6-shim.min.js"></script>
	}

	<script src="~/Scripts/iframeResizer.min.js"></script>
	<script src="~/Scripts/knockout-3.4.0.js"></script>
	<script src="~/Scripts/knockout.validation.debug.js"></script>
	<script src="~/Scripts/unsaved-changes-handler.js"></script>
	<script src="~/Scripts/core/data.js"></script>
	<script src="~/Scripts/core/utils.js"></script>
	<script src="~/Scripts/integration-point/time-utils.js"></script>
	<script src="~/Scripts/integration-point/binding.js"></script>

	<script>
		var helpURL = "https://help.kcura.com/integrationpoints";
	</script>
	<script src="~/Scripts/HelpUtil.js"></script>
	<script>
		IP.data.params = IP.data.params || {};
		IP.data.params['appID'] = @Model.AppID;
		IP.data.params['artifactID'] = @Model.ArtifactID;
		IP.data.params['userID'] = @Model.UserID;
		IP.data.params['caseUserID'] = @Model.CaseUserID;
		IP.data.params['URL'] = "@Html.Raw(@Model.URL)";
		IP.data.params['apiControllerName'] = '@Model.APIControllerName';

		IP.unsavedChangesHandler = new UnsavedChangesHandler();
		IP.unsavedChangesHandler.register();

		$("#cancel").on("click", function() {
			IP.unsavedChangesHandler.unregister();
			var getBasePath = IP.utils.getBasePath();
			var route = IP.redirect.get();
			if (!IP.redirect.isEdit()) {
				route = document.URL.split('CustomPages')[0]+"@Html.Raw(@Model.URL)" ;
			}
			window.top.location =route;
		});
	</script>
	<script src="~/Scripts/Import/import-preview-options-btn.js"></script>

	@Scripts.Render("~/bundles/ipEdit")
	@Scripts.Render("~/bundles/dragon")
	@Scripts.Render("~/bundles/exportProvider")
}