
*** Settings ***
| Documentation		| Testing the Encryption performed on the Integration Point objects.
| Metadata	     	| Authors	| William Sehy
| Force Tags		| in-progress	| team.game_of_holds	| feature.integration_points
| Suite Setup		| Suite Setup Keyword
#| Test Setup		| NONE
| Test Teardown 	| Capture Screenshot If Test Fails
| Suite Teardown	| Delete the Objects created in the Suite then Close All Browsers


*** Variables ***

| ${WorkspaceName}	| LDAP Sync
| ${IntegrationPointName}	| Database Encryption Testing
| ${ConnectionPath}			| testing.corp/CN=Users,DC=testing,DC=corp
| ${ObjectFilterString}		| (objectClass=*)
| ${Authentication}			| FastBind
| ${ConnectionUsername}		| testing\\administrator
| ${ConnectionPassword}		| P@ssw0rd@1
| ${ImportNestedItems}		| Yes
| ${Encrypted String}		| deuecphQItbCwbjgLpTXqBITBZBF7zPo86eOnPQc/6I/ET6rVOvNLQfUi8JpQqBDGhinUROm9SN2H3UYsQ/aIzOVJjBWZv3/LyAOauLVTsXPS//OjReq5m2Hko4/QkZo+qE6XtRWuO1/ipAHXSNbTpdFIw6c4okj0Q8bW4ZozGkSyRy/mud776kSLXx5ZKwtA5acbl7+4SBsxfDNWLPsJ25gRpyDQBRegrB7V2OQz1ctu3Qx2H1FbR/cVMCDayUheZosjO7gnWhrUI/NXAlFAuMQh16GalaA8v2+M8HXnZAbcsfYWKs5NDDw2Er71M25sbN0WO7B+UdNkR0Q7TMwR9gA4+829IFGosjW/FQxH0YLhsKbB1rRFJAcNeSofs1UB7HYCDxWPtFXhA5dQcnVev3dk2Lm98CK9++5tHp4tnx9LIRLepArEvCgoB/CJ/KHFXFyqOAVVFQY0wYZVgndSjXqyHrUFQMr1tCx0Rd3yjDks1kPy8OQqzKGeq/HDs8uxsQxiOEoxxMUOYbnH8PJcRxAYBEWb+6YrPwLkEhyXha+6knHRo814E1dBuehYISsIeAQkARw91F7vxeccRlDmyrTCZisdbKOYo6e2aloWTM=

 
*** Test Cases ***
 
| The Source Configuration value is encrypted in the Database 
| | [Documentation]	| Verify that the Source Configuration value on Integration Point objects is encrypted in the Database.
| | ...				| This works because the encryption always produces the same string when given the same Step 2 values.
| | [Tags]			| automated
| | Verify that the Following Integration Point has the following SourceConfiguration Value in the Database	| ${IntegrationPointName}	| ${Encrypted String}


*** Keywords *** 

| Verify that the Following Integration Point has the following SourceConfiguration Value in the Database
| | [Documentation]	| A keyword designed to verify that the Integration Point with the given name has the given SourceConfiguration value. Can be run from anywhere without leaving the page.
| | [ARGUMENTS]		| ${IntegrationPointName}	| ${ExpectedSourceConfiguration}
| | Verify that the Following Integration Point Exists in the current Workspace	| ${IntegrationPointName}
| | ${IntegrationPointName}=	| Replace String	| ${IntegrationPointName}	| '	| ''
| | ${ActualSourceConfiguration}=	| Query Workspace Database	| 
| | ... | SELECT SourceConfiguration
| | ... | FROM EDDSDBO.IntegrationPoint
| | ... | Where Name = '${IntegrationPointName}'
| | Log	| Expected Source Configuration: ${ExpectedSourceConfiguration}
| | Log	| Actual Source Configuration: ${ActualSourceConfiguration[0][0]}
| | Run Keyword Unless	| "${ActualSourceConfiguration[0][0]}" == "${ExpectedSourceConfiguration}"	| 
| | ... | Fail	| The SourceConfiguration field on the Integration Point "${IntegrationPointName}" was not the expected value.

| Suite Setup Keyword
| | [Documentation]	| Create the Suite Preconditions
| | Setup connection to the relativity database
| | Open and Log in to Legal Hold
| | Setup connection to the Relativity Services API for Legal Hold	| ${WorkspaceName}

| | ${IntegrationPointExists}=	| Determine if the Following Integration Point Exists in the current Workspace	| ${IntegrationPointName}
| | Run Keyword If	| ${${IntegrationPointExists}}	| Delete the following Integration Point using API	| ${IntegrationPointName}

| | @{Step1Fields}=		| Create List | 
| | ... | ${IntegrationPointName}
| | ... | LDAP						| 
| | ... | Custodian					| 
| | ... | No
| | @{Step2Fields}=		| Create List | 
| | ... | ${ConnectionPath}		| 
| | ... | ${ObjectFilterString}	| 
| | ... | ${Authentication}		| 
| | ... | ${ConnectionUsername}	| 
| | ... | ${ConnectionPassword}	| 
| | ... | ${ImportNestedItems}
| | @{Step3Mapping}=	| Create List	|
| | ... | Email			| mail			| 
| | ... | Department	| countrycode	| 
| | ... | First Name	| givenname		| 
| | ... | Last Name		| sn			| 
| | ... | UniqueID		| objectguid
| | Create LDAP Integration Point | ${Step1Fields} | ${Step2Fields} | ${Step3Mapping} | Append/Overlay | UniqueID
| | [Teardown]		| Drop connection to the relativity services api

| Delete the Objects created in the Suite then Close All Browsers
| | [Documentation]	| Delete the Integration Point created in this suite then closes all open browsers.
| | ...				| This is run as the Suite Teardown.
| | Setup connection to the Relativity Services API for Legal Hold	| ${WorkspaceName}

| | Delete the following Integration Point using API	| ${IntegrationPointName}

| | Drop connection to the relativity services api
| | Close All Browsers


*** Settings ***
| Library	| ${KEYWORD_DIR}/kWebDriver.py
| Resource	| ${KEYWORD_DIR}/LegalHold/Legal_Hold_Keywords_API.txt
| Resource	| ${LEGAL_HOLD_KEYWORD_DIR}/NavigationKeywords.txt
| Resource	| ${LDAP_KEYWORD_DIR}/DatabaseKeywords.txt
| Resource	| ${LDAP_KEYWORD_DIR}/IntegrationPointKeywords.txt
