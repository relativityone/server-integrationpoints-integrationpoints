*** Settings ***
| Documentation | Email Notifications when running Integration Points
| Metadata		| Authors	| Daniel Oliver
| Force Tags	| in-progress | team.game_of_holds	| feature.integration_points


*** Variables ***

| ${WorkspaceName}		| LDAP Sync
| ${IntegrationName1}	| Successful RIP
| ${IntegrationName2}	| Job Error RIP
| ${IntegrationName3}	| Item Level RIP


*** Test Cases ***

| Unpopulated SMTP Configuration values will log an error
| | [Documentation]	| Verify that when trying to send a notification with unpopulated SMTP configuration fields, that an error is logged in Relativity
| | ...				| [id] 05e2aca1-c41b-11e4-9a53-90b11c6c5ae4
| | [tags]			| manual	| destructive
| | Run the following manual steps:
| | ... | Steps:
| | ... | 1. Write down then Clear the value of the SMTPPort Instance Setting
| | ... | 2. Run an Integration Point that has Email Notifications enabled
| | ... |
| | ... | Expected Results:
| | ... | Verify that an error is logged in Relativity (QA Note: Expand this result. Say what error.)
| | ... |
| | ... | Teardown Steps:
| | ... | 1. Restore the SMTPPort Instance Setting 


| Notifications can be sent with Encrypted SMTP
| | [Documentation]	| 
| | ...				| [id] 15ab4261-def0-11e4-9434-90b11c6c5ae4
| | [tags]			| manual 
| | Run the following manual steps:
| | ... | Steps:
| | ... | 1. Go to the Tab: Relativity Script Library
| | ... | 2. View: Relativity SMTP Configuration
| | ... | 3. Run Script with Encrypt Password set to Yes
| | ... | 4. Run a RIP Import that has your email in the Email Notification Recipients
| | ... |
| | ... | Expected Results:
| | ... | Verify that the import email is sent


| Notifications can be sent with Unencrypted SMTP
| | [Documentation]	| 
| | ...				| [id] 199b1a30-def0-11e4-9bd5-90b11c6c5ae4
| | [tags]			| manual 
| | Run the following manual steps:
| | ... | Steps:
| | ... | 1. Go to the Tab: Relativity Script Library
| | ... | 2. View: Relativity SMTP Configuration
| | ... | 3. Run Script with Encrypt Password set to No
| | ... | 4. Run a RIP Import that has your email in the Email Notification Recipients
| | ... |
| | ... | Expected Results:
| | ... | Verify that the import email is sent


| Notifications are sent as the EmailFrom address in the configuration table
| | [Documentation] | Verify that the sent Email's From address uses the value of kCura.Notification EmailFrom
| | ...				| [id] 015200ee-c41b-11e4-9458-90b11c6c5ae4
| | [tags]			| manual
| | Run the following manual steps:
| | ... | Pre-conditions:
| | ... | 1. The Instance Settings have a valid (and populated) value for the EmailFrom setting 
| | ... | 2. An Integration Point has Email Notifications with your address
| | ... | 3. The Integration Point will run without error
| | ... |
| | ... | Steps:
| | ... | 1. Run the Integration Point
| | ... | 2. Wait for the job to complete
| | ... |
| | ... | Expected Results:
| | ... | Verify that the From Address of the Email Notification matches the Configuration's EmailFrom Instance Setting's value


| Verify Successful Notification
| | [Documentation]	| Verify that the success email is correct for successful RIP jobs
| | ...				| [id] c6abba00-c423-11e4-8dc6-90b11c6c5ae4
| | [tags]			| manual
| | Run the following manual steps:
| | ... | Pre-conditions:
| | ... | 1. The ${IntegrationName1} RIP has Email Notifications with your address
| | ... | 2. It will run without error
| | ... |
| | ... | Steps:
| | ... | 1. Run the ${IntegrationName1} Integration Point
| | ... | 2. Wait for the job to complete
| | ... | 3. Check your email
| | ... |
| | ... | Expected Results:
| | ... | 1. Verify that the email's subject line is: 
| | ... | - Relativity Job successfully completed for "${IntegrationName1}".
| | ... | 2. Verify that the email's body is:
| | ... | - A Job for the following Relativity Integration Point has successfully completed.
| | ... | - 
| | ... | - Name: [RIP Name]
| | ... | - Destination Workspace: [Workspace Name] - [Workspace ID]


| Verify the Completed with Errors Notification Email
| | [Documentation]	| Verify that the email is correct for RIP jobs that Completed with Errors.
| | ...				| [id] f8df7dcf-c433-11e4-8bea-90b11c6c5ae4
| | [Tags]			| manual
| | Run the following manual steps:
| | ... | Pre-conditions:
| | ... | 1. The ${IntegrationName3} RIP has Email Notifications with your address
| | ... | 2. It will run with errors (Duplicate Unique Identifier)
| | ... |
| | ... | Steps:
| | ... | 1. Run the ${IntegrationName3} Integration Point
| | ... | 2. Wait for the job to complete
| | ... | 3. Check your email
| | ... |
| | ... | Expected Results:
| | ... | 1. Verify that the email's subject line is:
| | ... | - Relativity Job completed with errors for "${IntegrationName3}".
| | ... | 2. Verify that the email's body is:
| | ... | - An error has occurred for the below Relativity Integration Point.
| | ... | - 
| | ... | - Name: ${IntegrationName3}
| | ... | - Destination Workspace: [Workspace Name] - [Workspace ID]
| | ... | - 
| | ... | - For error details, please review job history errors for this integration point.


| Verify the Job Error Notification Email
| | [Documentation]	| Verify that the email is correct for job level errored RIP jobs
| | ...				| [id] cdbf85c0-c431-11e4-9b95-90b11c6c5ae4
| | [tags]			| manual	| destructive	| outdated
| | Run the following manual steps:
| | ... | Pre-conditions:
| | ... | 1. The ${IntegrationName2} RIP has Email Notifications with your address
| | ... | 2. It will run with Job level errors (disable RelativityWebAPI Authentication)
| | ... |
| | ... | Steps:
| | ... | 1. Run the ${IntegrationName2} Integration Point
| | ... | 2. Wait for the job to complete
| | ... | 3. Check your email
| | ... |
| | ... | Expected Results:
| | ... | 1. Verify that the email's subject line is:
| | ... | - An error has occurred for Relativity import "${IntegrationName2}" 
| | ... | 2. Verify that the email's body is:
| | ... | - An error has occurred for the below Relativity Integration Point.
| | ... | - 
| | ... | - Name: ${IntegrationName2}
| | ... | - Workspace: [Workspace Name] - [Workspace ID]
| | ... | - Error: [Full stack trace error for the most recent error]


*** Settings ***
| Library	| ${KEYWORD_DIR}/ManualKeywords.py
| Library	| ${KEYWORD_DIR}/kWebDriver.py