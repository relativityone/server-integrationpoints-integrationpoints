
*** Settings ***
| Documentation 	| Verify that the 
| Metadata			| Authors | Daniel Oliver
| Force Tags		| in-progress | team.game_of_holds | feature.integration_points
| Suite Setup		| Create Suite Setup Data
| Test Teardown 	| Run Keyword if Test Failed | Capture Page Screenshot
| Suite Teardown	| Delete the Objects created in the Suite then Close All Browsers


*** Variables ***

| ${WorkspaceName}	 | LDAP Sync
| ${Wildcard1} | Wildcard Golden 
| ${File1}     | Wildcard File 05-13-2016.csv
| ${File2}     | Wildcard File 05-14-2016.csv
| ${Custodian1} | Bimmy, Jimmy

*** Test Cases ***

| The Newest Dated File is loaded 
| | [Documentation] | Verify that once a dated file (import uses wildcards on the file's name) is imported, that the next import uses a newer dated file
| | ...	| [id] c446f451-3330-11e6-8589-989096e24b46
| | [Tags] | untested
| | @{Step1Fields}=	| Create list | ${Wildcard1} | FTP (CSV File) | Custodian | No
| | @{Step2Fields}=	| Create list | filetransfer.kcura.com | FTP | 21 | admin | C@m3l!ts | /Custom Development/ftp/LegalHold/Wildcard File *MM*-*dd*-*yyyy*.csv
| | @{Step3Mapping}=	| Create List	|
| | ... | Department	| Department 
| | ... | Email			| Email		 
| | ... | First Name	| FirstName 
| | ... | Last Name		| LastName	 
| | ... | Employment Start Date | Start Date
| | ... | UniqueID		| objectguid
| | Create LDAP Integration Point | ${Step1Fields} | ${Step2Fields} | ${Step3Mapping} | Append Only | Email
| | Run Import Now on the Following Integration Point	| ${IntegrationName}
| | View Integration Point | ${Wildcard1}
| | Run the following manual steps:
| | ... | 1. View ${Custodian1} and verify that their employment Start Date is 1/1/2017
| | ... | 2. Copy ${File2} to the ${FTPLegalHold} folder
| | ... | 3. View Integration Point ${NewestFile}, and click Import Now
| | ... | 4. View ${Custodian1} 
| | ... | 
| | ... | Expected Results:
| | ... | 1. Verify that ${Custodian1}'s employment Start Date is 2/2/2018

| 


*** Keywords *** 

| Create Suite Setup Data
| | [Documentation]	| Create the Suite Preconditions
| | Setup connection to the relativity database
| | Open and Log in to Legal Hold
| | Setup connection to the Relativity Services API for Legal Hold	| ${WorkspaceName}

# --------------------------------------------------------------------------------------------------------

| | @{Step1Fields}=	| Create list | ${IntegrationName} | FTP (CSV File) | Custodian | No
| | @{Step2Fields}=	| Create list | filetransfer.kcura.com | FTP | 21 | admin | C@m3l!ts | /Custom Development/ftp/LegalHold/UnlockedFields.csv
| | @{Step3Mapping}=	| Create List	|
| | ... | Department	| Department 
| | ... | Email			| Email		 
| | ... | First Name	| FirstName 
| | ... | Last Name		| LastName	 
| | ... | UniqueID		| objectguid
| | Create LDAP Integration Point | ${Step1Fields} | ${Step2Fields} | ${Step3Mapping} | Append Only | Email
| | View Integration Point | ${IntegrationName}
| | Click | Edit
| | Wait for then Select iFrame	| id=_externalPage	| 10s | The Page never redirected after clicking "Edit".
| | [Teardown]		| Run Keywords | Drop connection to the relativity services api | Capture Page Screenshot

| Verify that the following field is not disabled
| | [Documentation] | Verify that the following field is not disabled on the edit screen.
| | [ARGUMENTS] | ${FieldName}
| | xpath=//input[@id='${FieldName}' and not @disabled]
 
| Delete the Objects created in the Suite then Close All Browsers
| | [Documentation]	| Delete the Suite test data of Integration Point and Custodians.
| | Setup connection to the Relativity Services API for Legal Hold	| ${WorkspaceName}

| | Delete the Custodians in the Following Department using API	| UnLockedFields
| | Delete the following Integration Point using API | ${Wildcard1}

| | Drop connection to the relativity services api
| | Close All Browsers


*** Settings ***
| Library	| Collections
| Library	| ${KEYWORD_DIR}/kWebDriver.py
| Resource	| ${KEYWORD_DIR}/LegalHold/Legal_Hold_Keywords_API.txt
| Resource	| ${LEGAL_HOLD_KEYWORD_DIR}/GridKeywords.txt
| Resource	| ${LEGAL_HOLD_KEYWORD_DIR}/MiscLegalHoldKeywords.txt
| Resource	| ${LEGAL_HOLD_KEYWORD_DIR}/NavigationKeywords.txt
| Resource	| ${LDAP_KEYWORD_DIR}/IntegrationPointKeywords.txt