
*** Settings ***
| Documentation		| Verify that running an Append FTP import creates new objects, but does not update existing objects.
| Metadata			| Authors	| Daniel Oliver
| Force Tags		| in-progress	| team.game_of_holds	| feature.integration_points
| Suite Setup		| Create Suite Setup Data
| Test Teardown		| Run Keyword if Test Failed	| Capture Page Screenshot
| Suite Teardown	| Delete the Objects created in the Suite then Close All Browsers


*** Variables ***

| ${WorkspaceName}						| LDAP Sync
| ${IntegrationName}					| Append FTP
| ${NewObject}							| ManFTP, Cat
| ${ExistingAndManagerUpdatedObject}	| ManFTP, Dog
| ${ExistingNoChangeObject}				| ManFTP, Bird
| ${Manager}							| ManFTP, Bigdog
| ${ExistingAndUpdatedObject}			| ManFTP, CatDog


*** Test Cases ***

| An Append import Creates new objects
| | [Documentation] | Verify that when an Append RIP is run which has new Source objects, that it creates new objects in the Target RDO.
| | ...				| [id] 5994fc0f-2e7b-11e6-b4a3-989096e24b46
| | [Tags]			| automated	| rewrite_me
| | View Custodian	| ${NewObject}	
| | Verify the current layout has fields with the following values	| 
| | ... | First Name	| Cat
| | ... | Last Name		| ManFTP
| | ... | Department	| AppendFTP
| | ... | Email			| CatManFTP@gameofholdstesting.corp


| An Append imports will Overlay Managers
| | [Documentation] | Verify that Append imports will Overlay Manager information by linking an Existing Custodians to a new Manager.
| | ...				| [id] e1208a00-2e7b-11e6-8fa2-989096e24b46
| | [Tags]			| automated
| | View Custodian	| ${ExistingAndManagerUpdatedObject} 
| | Verify the current layout has fields with the following values | Manager | ${Manager}


| An Append import Creates new History objects
| | [Documentation] | Verify that when an Append RIP is run which has new source recods, 
| | ...				| that there are history entries for the newly created objects in the target RDO.
| | ...				| [id] 7f9c4930-2e7c-11e6-aa89-989096e24b46
| | [Tags]			| manual
| | Go to the Tab	| Custodians

| | Run the following manual steps:
| | ... | Steps:
| | ... | 1. View Custodian: ${NewObject}
| | ... | 2. Click: View Audit
| | ... |
| | ... | Expected Results:
| | ... | Verify that there is no entry with the Action of "Update - Import"


| An Append import does not update existing objects
| | [Documentation] | Verify that when an Append RIP is run which has updated Source objects that match to existing objects, 
| | ...				| that it does not update the existing objects in the target RDO.
| | ...				| [id] 83486140-2e7c-11e6-a9b4-989096e24b46
| | [Tags]			| manual
| | Go to the Tab	| Custodians

| | Run the following manual steps:
| | ... | Steps:
| | ... | 1. View Custodian: ${ExistingAndUpdatedObject} (If multiple exist, this suite fails)
| | ... | 2. Click: View Audit
| | ... |
| | ... | Expected Results:
| | ... | Verify that there is no entry with the Action of "Update - Import"


| An Append import updates the Manager 
| | [Documentation] | Verify that when an Append RIP is run which has updated Source Custodian's Managers that match to existing objects, 
| | ...				| that it does not update the existing objects in the target RDO.
| | ...				| 
| | [Tags]			| manual
| | Go to the Tab	| Custodians

| | Run the following manual steps:
| | ... | Steps:
| | ... | 1. View Custodian: ${ExistingAndManagerUpdatedObject} (If multiple exist, this suite fails)
| | ... | 2. Click: View Audit
| | ... |
| | ... | Expected Results:
| | ... | Verify that the most recent entry has the Action of "Update - Import"


| An Append import does not update existing unmodified objects
| | [Documentation] | Verify that when an Append RIP is run which has Source objects that match to existing objects with no changes, 
| | ...				| that it does not update the existing objects in the target RDO.
| | ...				| [id] 87597cb0-2e7c-11e6-83f1-989096e24b46
| | [Tags]			| manual
| | Go to the Tab	| Custodians

| | Run the following manual steps:
| | ... | Steps:
| | ... | 1. View Custodian: ${ExistingNoChangeObject} (If multiple exist, this suite fails)
| | ... | 2. Click: View Audit
| | ... |
| | ... | Expected Results:
| | ... | Verify that there is no entry with the Action of "Update - Import"


| An Append import's Job History does not fail when there are Existing Objects
| | [Documentation] | Verify that when an Append RIP is run which has Source objects that match to existing objects,
| | ...				| that the Import's Job History has not errors.
| | ...				| [id] 8dd7c791-2e7c-11e6-b1f6-989096e24b46
| | [Tags]			| manual
| | Go to the Tab	| Job History

| | Run the following manual steps:
| | ... | Steps:
| | ... | 1. Filter by Name: ${IntegrationName}
| | ... | 
| | ... | Expected Results:
| | ... | Verify that the newest entry for "${IntegrationName}" has no Errors


*** Keywords *** 

| Create Suite Setup Data
| | [Documentation]	| Create the Suite Preconditions
| | Setup connection to the relativity database
| | Open and Log in to Legal Hold
| | Setup connection to the Relativity Services API for Legal Hold	| ${WorkspaceName}

# --------------------------------------------------------------------------------------------------------

| | ${CustodianExists}=	| Determine if the Following Custodian Exists in the current Workspace	| ${Manager}
| | Run Keyword If	| ${${CustodianExists}}	| Delete the following Custodian using API	| ${Manager}

| | ${CustodianExists}=	| Determine if the Following Custodian Exists in the current Workspace	| ${NewObject}
| | Run Keyword If	| ${${CustodianExists}}	| Delete the following Custodian using API	| ${NewObject}

| | ${CustodianExists}=	| Determine if the Following Custodian Exists in the current Workspace	| ${ExistingNoChangeObject}
| | Run Keyword If	| ${${CustodianExists}}	| Delete the following Custodian using API	| ${ExistingNoChangeObject}
| | Create a Custodian using API	| 
| | ... | Full Name		| ${ExistingNoChangeObject}
| | ... | Email			| BirdManFTP@gameofholdstesting.corp
| | ... | Department	| AppendFTP
| | ... | UniqueID		| 2b381d6d-d29d-4058-a989-a0ea7f10ww7

| | ${CustodianExists}=	| Determine if the Following Custodian Exists in the current Workspace	| ${ExistingAndManagerUpdatedObject}
| | Run Keyword If	| ${${CustodianExists}}	| Delete the following Custodian using API	| ${ExistingAndManagerUpdatedObject}
| | Create a Custodian using API	| 
| | ... | Full Name		| ${ExistingAndManagerUpdatedObject}		
| | ... | Email			| DogManFTP@gameofholdstesting.corp
| | ... | Department	| AppendFTP
| | ... | UniqueID		| 2b381d6d-d29d-4058-a989-a0ea7f10707f

| | ${CustodianExists}=	| Determine if the Following Custodian Exists in the current Workspace	| ${ExistingAndUpdatedObject}
| | Run Keyword If	| ${${CustodianExists}}	| Delete the following Custodian using API	| ${ExistingAndUpdatedObject}
| | Create a Custodian using API	| 
| | ... | Full Name		| ${ExistingAndUpdatedObject}		
| | ... | Email			| CatDogManFTP@gameofholdstesting.corp
| | ... | Department	| AppendFT
| | ... | UniqueID		| 2b336d6d-d59d-4058-a939-a0ea2f10707u

# --------------------------------------------------------------------------------------------------------

| | ${IntegrationPointExists}=	| Determine if the Following Integration Point Exists in the current Workspace	| ${IntegrationName}
| | Run Keyword If	| ${${IntegrationPointExists}}	| Delete the following Integration Point 	| ${IntegrationName}

| | @{Step1Fields}=	| Create List	| 
| | ... | ${IntegrationName}
| | ... | FTP (CSV File)
| | ... | Custodian
| | ... | No

| | @{Step2Fields}=	| Create List	| 
| | ... | files.kcura.com
| | ... | FTP
| | ... | 21
| | ... | rip
| | ... | GameOfHolds
| | ... | /ftp/LegalHold/AppendFTP.csv

| | @{Step3Mapping}=	| Create List	|
| | ... | Department	| Department
| | ... | Email			| Email
| | ... | First Name	| FirstName
| | ... | Last Name		| LastName
| | ... | Manager		| Manager
| | ... | UniqueID		| unique_id

| | Create FTP Integration Point	| ${Step1Fields}	| ${Step2Fields}	| ${Step3Mapping}	| Append Only	| UniqueID

| | Run Import Now on the Following Integration Point | ${IntegrationName}
| | [Teardown]		| Run Keywords	| Drop connection to the relativity services api	| Capture Page Screenshot

| Delete the Objects created in the Suite then Close All Browsers
| | [Documentation]	| Delete the Suite test data of Integration Point and Custodians.
| | Setup connection to the Relativity Services API for Legal Hold	| ${WorkspaceName}

| | ${CustodianExists}=	| Determine if the Following Custodian Exists in the current Workspace	| ${Manager}
| | Run Keyword If	| ${${CustodianExists}}	| Delete the following Custodian using API	| ${Manager}
| | ${CustodianExists}=	| Determine if the Following Custodian Exists in the current Workspace	| ${NewObject}
| | Run Keyword If	| ${${CustodianExists}}	| Delete the following Custodian using API	| ${NewObject}

| | Delete the following Custodian using API	| ${ExistingNoChangeObject}
| | Delete the following Custodian using API	| ${ExistingAndManagerUpdatedObject}
| | Delete the following Custodian using API	| ${ExistingAndUpdatedObject}

| | Delete the following Integration Point	| ${IntegrationName}

| | Drop connection to the relativity services api
| | Close All Browsers


*** Settings ***
| Library	| Collections
| Library	| ${KEYWORD_DIR}/ManualKeywords.py
| Library	| ${KEYWORD_DIR}/kWebDriver.py
| Resource	| ${KEYWORD_DIR}/LegalHold/Legal_Hold_Keywords_API.txt
| Resource	| ${LEGAL_HOLD_KEYWORD_DIR}/MiscLegalHoldKeywords.txt
| Resource	| ${LEGAL_HOLD_KEYWORD_DIR}/NavigationKeywords.txt
| Resource	| ${LDAP_KEYWORD_DIR}/GenericKeywords.txt