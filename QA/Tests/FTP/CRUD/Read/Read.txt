
*** Settings ***
| Documentation 	| Verify that the Read pages for Integration Point objects have the fields and sections for given situations.
| Metadata			| Authors	| Daniel Oliver	| William Sehy
| Force Tags		| in-progress	| team.game_of_holds	| feature.integration_points
| Suite Setup		| Suite Setup Keyword
#| Test Setup		| NONE | # All cases have Test Setups 
| Test Teardown 	| Capture Screenshot if Test Fails
| Suite Teardown	| Delete the Objects created in the Suite then Close All Browsers


*** Variables ***

| ${WorkspaceName}		| LDAP Sync
| ${IntegrationPoint1}	| FTP Integration Point 1	| # Enable Scheduler is set to No
| ${IntegrationPoint2}	| FTP Integration Point 2	| # Daily Schedule
| ${IntegrationPoint3}	| FTP Integration Point 3	| # Weekly Schedule
| ${IntegrationPoint4}	| FTP Integration Point 4	| # Monthly Schedule


| ${ImportNestedItems}	| Yes


*** Test Cases ***

| The Integration Point Read page defaults to the correct Layout
| | [Documentation]	| Verify that the default Layout on an Integration Point Read page is "Integration Point Details". 
| | ...				| 
| | [Tags]			| 
| | [Setup]			| View Integration Point	| ${IntegrationPoint1}
| | Verify that the layout dropdown is set to "Integration Point Details"


| The Integration Point Read page has the correct Layouts
| | [Documentation]	| Verify that the Integration Point Read page has only the "Integration Point Details" Layout. 

| | [Tags]			| 
| | [Setup]			| View Integration Point	| ${IntegrationPoint1}
| | Verify that the Layout Dropdown only has the following Layouts	| Integration Point Details


| The correct Buttons appear in the Header
| | [Documentation]	| Verify that the correct buttons appear at the top of the page.
| | ...				| 
| | [Tags]			| 
| | [Setup]			| View Integration Point	| ${IntegrationPoint1}
| | Verify the buttons are available on the layout	| 
| | ... | Edit
| | ... | Delete
| | ... | Back
| | ... | Edit Permissions
| | ... | View Audit


| The Cards and Category Tabs are in the correct order
| | [Documentation]	| Verify that the Cards and Category Tabs are sorted correctly on the "Integration Point Details" Layout.
| | ...				| 
| | [Tags]			| 
| | [Setup]			| View Integration Point	| ${IntegrationPoint1}
| | Verify that the current Layout has the following Cards and Layout Groups in Order	| Layout Group	| Status
| | Verify that the following Layout Group has the following Category Tabs in Order | Layout Group	| General	| Scheduling


| The General Category Tab's Fields are in the correct order
| | [Documentation]	| Verify that the General Category Tab's Fields are present and sorted correctly on the "Integration Point Details" Layout.
| | ...				| 
| | [Tags]			| 
| | [Setup]			| View Integration Point	| ${IntegrationPoint1}
| | Verify that the following Tabbed Card contains the following Fields in order | Layout Group  | General	| 
| | ... | Name:			| Log Errors:
| | ...					| Has Errors: 
| | ... | Overwrite:	| Email Notification Recipients:
| | ... | Source Provider
| | ... | Destination RDO:
| | ... | Host:
| | ... | Port:
| | ... | Protocol:
| | ... | Username:
| | ... | Password:
| | ... | Filename Prefix:
| | ... | Tomezone Offset:	| # Really? Really?


| The Password Field shows six asterixes when populated
| | [Documentation]	| Verify that the Password field on the General Category Tab is shown as "******" when a value was entered during creation.
| | [Tags]			| 
| | [Setup]			| View Integration Point	| ${IntegrationPoint1}
| | Select Category Tab	| General
| | Wait Until Keyword Succeeds	| 10s	| 2s	| Verify that the following Field has the Following Value	| Password:	| ******


#| The Scheduling Category Tab's Fields are in the correct order
#| | [Documentation]	| Verify that the General Category Tab's Fields are present and sorted correctly on the "Integration Point Details" Layout.
#| | ...				| 
#| | [Tags]			| 
#| | [Setup]			| View Integration Point	| ${IntegrationPoint1}
#| | Verify that the following Tabbed Card contains the following Fields in order | Layout Group  | Scheduling	| 
#| | ... | Enable Scheduler:	| Next Scheduled Runtime (UTC):
#| | ... | Frequency:		| Last Runtime (UTC):
#| | ... | Start Date:
#| | ... | End Date:
#| | ... | Scheduled Time (UTC):


#| The correct Fields are present when Enable Scheduler is set to No
#| | [Documentation]	| Verify that the correct Fields are present on the "Integration Point Details" Layout when Enable Scheduler is set to No.
#| | ...				| 
#| | [Tags]			| manual	| partially_automated	| field_placement
#| | [Setup]			| View Integration Point	| ${IntegrationPoint1}
#| | Run the following manual steps:
#| | ... | Expected Results:
#| | ... | 1. Verify that the "General" Category has the following fields in order:	| 
#| | ... | - Name			| 
#| | ... | - Overwrite		| 
#| | ... | - Source Provider	| 
#| | ... | - Destination RDO	| 
#| | ... | - Log Errors      | 
#| | ... | - Email Notification Recipients
#| | ... | 2. Verify that the "Status" Category has the following fields in order:	| 
#| | ... | - Next Scheduled Runtime (UTC)	| 
#| | ... | - Last Runtime (UTC)
#| | ... | 3. Verify that the "Import Scheduling" Category has the following fields in order:	| 
#| | ... | - Enable Scheduler	|
#| | ... | - Frequency			| 
#| | ... | - Start Date			| 
#| | ... | - End Date			| 
#| | ... | - Scheduled Time (UTC)
#| | ... | 4. Verify that the "Source Connection" Category has the following fields in order:	| 
#| | ... | - Connection Path			| 
#| | ... | - Object Filter String	| 
#| | ... | - Authentication			| 
#| | ... | - Username				| 
#| | ... | - Password				| 
#| | ... | - Import Nested Items
#
#
#| The correct Fields are present when Frequency is set to Daily
#| | [Documentation]	| Verify that the correct Fields are present on the "Integration Point Details" Layout when Enable Scheduler is set to Yes and Frequency is set to Daily.
#| | ...				| 
#| | [Tags]			| manual	| partially_automated	| field_placement
#| | [Setup]			| View Integration Point	| ${IntegrationPoint2}
#| | Run the following manual steps:
#| | ... | Expected Results:
#| | ... | 1. Verify that the "General" Category has the following fields in order:	| 
#| | ... | - Name			| 
#| | ... | - Overwrite		| 
#| | ... | - Source Provider	| 
#| | ... | - Destination RDO	| 
#| | ... | - Log Errors      | 
#| | ... | - Email Notification Recipients
#| | ... | 2. Verify that the "Status" Category has the following fields in order:	| 
#| | ... | - Next Scheduled Runtime (UTC)	| 
#| | ... | - Last Runtime (UTC)
#| | ... | 3. Verify that the "Import Scheduling" Category has the following fields in order:	| 
#| | ... | - Enable Scheduler	|
#| | ... | - Frequency			| 
#| | ... | - Start Date			| 
#| | ... | - End Date			| 
#| | ... | - Scheduled Time (UTC)
#| | ... | 4. Verify that the "Source Connection" Category has the following fields in order:	| 
#| | ... | - Connection Path			| 
#| | ... | - Object Filter String	| 
#| | ... | - Authentication			| 
#| | ... | - Username				| 
#| | ... | - Password				| 
#| | ... | - Import Nested Items
#
#
#| All Fields are present when Frequency is set to Weekly
#| | [Documentation]	| Verify that the correct Fields are present on the "Integration Point Details" Layout when Enable Scheduler is set to Yes and Frequency is set to Weekly.
#| | ...				| 
#| | [Tags]			| manual	| partially_automated	| field_placement
#| | [Setup]			| NONE
#| | @{Step1Fields}=	| Create List	| 
#| | ... | ${IntegrationPoint3}
#| | ... | LDAP
#| | ... | Custodian
#| | ... | Yes
#| | ... | Weekly
#| | ... | 3
#| | ... | Monday; Friday
#| | ... | 2/10/2035
#| | ... | 2/18/2035
#| | ... | 12:30 PM
#
#| | @{Step2Fields}=		| Create List	| 
#| | ... | ${ConnectionPath}		| 
#| | ... | ${ObjectFilterString}	| 
#| | ... | ${Authentication}		| 
#| | ... | ${ConnectionUsername}	| 
#| | ... | ${ConnectionPassword}	| 
#| | ... | ${ImportNestedItems}
#
#| | @{Step3Mapping}=	| Create List	| 
#| | ... | Email			| mail			| 
#| | ... | Department	| countrycode	| 
#| | ... | First Name	| givenname		| 
#| | ... | Last Name		| sn			| 
#| | ... | UniqueID		| objectguid
#
#| | Create LDAP Integration Point | ${Step1Fields} | ${Step2Fields} | ${Step3Mapping} | Append/Overlay | UniqueID
#
#| | View Integration Point	| ${IntegrationPoint3}
#
#| | Run the following manual steps:
#| | ... | Expected Results:
#| | ... | 1. Verify that the "General" Category has the following fields in order:	| 
#| | ... | - Name			| 
#| | ... | - Overwrite		| 
#| | ... | - Source Provider	| 
#| | ... | - Destination RDO	| 
#| | ... | - Log Errors      | 
#| | ... | - Email Notification Recipients
#| | ... | 2. Verify that the "Status" Category has the following fields in order:	| 
#| | ... | - Next Scheduled Runtime (UTC)	| 
#| | ... | - Last Runtime (UTC)
#| | ... | 3. Verify that the "Import Scheduling" Category has the following fields in order:	| 
#| | ... | - Enable Scheduler	|
#| | ... | - Frequency			| 
#| | ... | -	Reoccur				| 
#| | ... | -	Send On				| 
#| | ... | - Start Date			| 
#| | ... | - End Date			| 
#| | ... | - Scheduled Time (UTC)
#| | ... | 4. Verify that the "Source Connection" Category has the following fields in order:	| 
#| | ... | - Connection Path			| 
#| | ... | - Object Filter String	| 
#| | ... | - Authentication			| 
#| | ... | - Username				| 
#| | ... | - Password				| 
#| | ... | - Import Nested Items
#
#
#| All Fields are present when Frequency is set to Monthly
#| | [Documentation]	| Verify that the correct Fields are present on the "Integration Point Details" Layout when Enable Scheduler is set to Yes and Frequency is set to Monthly.
#| | ...				| 
#| | [Tags]			| manual	| partially_automated	| field_placement
#| | [Setup]			| NONE
#| | @{Step1Fields}=	| Create List	| 
#| | ... | ${IntegrationPoint4}
#| | ... | LDAP
#| | ... | Custodian
#| | ... | Yes
#| | ... | Monthly
#| | ... | 3
#| | ... | Day 15 of the month
#| | ... | 2/15/2035
#| | ... | 2/16/2035
#| | ... | 12:30 PM
#
#| | @{Step2Fields}=		| Create List	| 
#| | ... | ${ConnectionPath}		| 
#| | ... | ${ObjectFilterString}	| 
#| | ... | ${Authentication}		| 
#| | ... | ${ConnectionUsername}	| 
#| | ... | ${ConnectionPassword}	| 
#| | ... | ${ImportNestedItems}
#
#| | @{Step3Mapping}=	| Create List	| 
#| | ... | Email			| mail			| 
#| | ... | Department	| countrycode	| 
#| | ... | First Name	| givenname		| 
#| | ... | Last Name		| sn			| 
#| | ... | UniqueID		| objectguid
#
#| | Create LDAP Integration Point | ${Step1Fields} | ${Step2Fields} | ${Step3Mapping} | Append/Overlay | UniqueID
#
#| | View Integration Point	| ${IntegrationPoint4}
#
#| | Run the following manual steps:
#| | ... | Expected Results:
#| | ... | 1. Verify that the "General" Category has the following fields in order:	| 
#| | ... | - Name			| 
#| | ... | - Overwrite		| 
#| | ... | - Source Provider	| 
#| | ... | - Destination RDO	| 
#| | ... | - Log Errors      | 
#| | ... | - Email Notification Recipients
#| | ... | 2. Verify that the "Status" Category has the following fields in order:	| 
#| | ... | - Next Scheduled Runtime (UTC)	| 
#| | ... | - Last Runtime (UTC)
#| | ... | 3. Verify that the "Import Scheduling" Category has the following fields in order:	| 
#| | ... | - Enable Scheduler	|
#| | ... | - Frequency			| 
#| | ... | -	Reoccur				| 
#| | ... | -	Send On				| 
#| | ... | - Start Date			| 
#| | ... | - End Date			| 
#| | ... | - Scheduled Time (UTC)
#| | ... | 4. Verify that the "Source Connection" Category has the following fields in order:	| 
#| | ... | - Connection Path			| 
#| | ... | - Object Filter String	| 
#| | ... | - Authentication			| 
#| | ... | - Username				| 
#| | ... | - Password				| 
#| | ... | - Import Nested Items


*** Keywords ***

| Verify that the following Field has the Following Value
| | [Documentation]	| This keyword verifies that the given field has the given value.
| | ...				| Written because "Verify the current layout has fields with the following values" does not work for some reason.
| | [ARGUMENTS]		| ${FieldName}	| ${ExpectedValue}
| | Element Should Be Visible	| xpath=//td[@class='dynamicViewFieldName' and text()="${FieldName}"]	| The field ${FieldName} was not visible.
| | ${ActualValue}=	| Get Text	| xpath=//td[@class='dynamicViewFieldName' and text()="${FieldName}"]/following-sibling::td[@class='dynamicViewFieldValue']
| | Should Be Equal As Strings	| ${ExpectedValue}	| ${ActualValue}

| Verify that the Layout Dropdown only has the following Layouts
| | [Documentation]	| This keyword verifies that the Layout dropdown has only the given Layouts in any order.
| | ...				| This keyword assumes that the Layout dropdown's name is "_dynamicTemplate$ctl03".
| | [ARGUMENTS]		| @{ExpectedLayouts}
| | Element Should Be Visible	| css=select[name='_dynamicTemplate$ctl03']	| The Layout dropdown was not found.
| | @{ActualLayouts}=	| Get Element Text	| css=select[name='_dynamicTemplate$ctl03'] > option	| False
| | Sort List	| ${ExpectedLayouts}
| | Sort List	| ${ActualLayouts}
| | Lists Should Be Equal	| ${ExpectedLayouts}	| ${ActualLayouts}

| Suite Setup Keyword
| | [Documentation]	| Create the Suite Preconditions
| | Setup connection to the relativity database
| | Open and Log in to Legal Hold
| | Setup connection to the Relativity Services API for Legal Hold	| ${WorkspaceName}

# --------------------------------------------------------------------------------------------------------

| | ${IntegrationPointExists}=	| Determine if the Following Integration Point Exists in the current Workspace	| ${IntegrationPoint1}
| | Run Keyword If	| ${${IntegrationPointExists}}	| Delete the following Integration Point using API	| ${IntegrationPoint1}

| | ${IntegrationPointExists}=	| Determine if the Following Integration Point Exists in the current Workspace	| ${IntegrationPoint2}
| | Run Keyword If	| ${${IntegrationPointExists}}	| Delete the following Integration Point using API	| ${IntegrationPoint2}

| | ${IntegrationPointExists}=	| Determine if the Following Integration Point Exists in the current Workspace	| ${IntegrationPoint3}
| | Run Keyword If	| ${${IntegrationPointExists}}	| Delete the following Integration Point using API	| ${IntegrationPoint3}

| | ${IntegrationPointExists}=	| Determine if the Following Integration Point Exists in the current Workspace	| ${IntegrationPoint4}
| | Run Keyword If	| ${${IntegrationPointExists}}	| Delete the following Integration Point using API	| ${IntegrationPoint4}

# --------------------------------------------------------------------------------------------------------

| | @{Step1Fields}=	| Create List	| 
| | ... | ${IntegrationPoint1}
| | ... | FTP
| | ... | Custodian
| | ... | No

| | @{Step2Fields}=	| Create List	| 
| | ... | Host=filetransfer.kcura.com
| | ... | Protocol=FTP
| | ... | Port=21
| | ... | Username=admin
| | ... | Password=C@m3l!ts
| | ... | Filepath=/Custom Development/ftp/LegalHold/AppendFTP.csv

| | @{Step3Mapping}=	| Create List	| 
| | ... | UniqueID		| unique_id
| | ... | First Name	| FirstName
| | ... | Last Name		| LastName
| | ... | Email			| Email

| | Create FTP Integration Point | ${Step1Fields} | ${Step2Fields} | ${Step3Mapping} | Append/Overlay | UniqueID

# --------------------------------------------------------------------------------------------------------

| | @{Step1Fields}=	| Create List	| 
| | ... | ${IntegrationPoint2}
| | ... | FTP
| | ... | Custodian
| | ... | Yes
| | ... | Daily
| | ... | NULL
| | ... | NULL
| | ... | 2/15/2035
| | ... | 2/16/2035
| | ... | 12:30 PM

| | @{Step2Fields}=	| Create List	| 
| | ... | Host=filetransfer.kcura.com
| | ... | Protocol=FTP
| | ... | Port=21
| | ... | Username=admin
| | ... | Password=C@m3l!ts
| | ... | Filepath=/Custom Development/ftp/LegalHold/AppendFTP.csv

| | Create FTP Integration Point | ${Step1Fields} | ${Step2Fields} | ${Step3Mapping} | Append/Overlay | UniqueID
| | [Teardown]		| Drop connection to the relativity services api

| Delete the Objects created in the Suite then Close All Browsers
| | [Documentation]	| Delete the Integration Points created in this suite then closes all open browsers.
| | ...				| This is run as the Suite Teardown.
| | Setup connection to the Relativity Services API for Legal Hold	| ${WorkspaceName}

| | Delete the following Integration Point using API	| ${IntegrationPoint1}
| | Delete the following Integration Point using API	| ${IntegrationPoint2}

| | ${IntegrationPointExists}=	| Determine if the Following Integration Point Exists in the current Workspace	| ${IntegrationPoint3}
| | Run Keyword If	| ${${IntegrationPointExists}}	| Delete the following Integration Point using API	| ${IntegrationPoint3}

| | ${IntegrationPointExists}=	| Determine if the Following Integration Point Exists in the current Workspace	| ${IntegrationPoint4}
| | Run Keyword If	| ${${IntegrationPointExists}}	| Delete the following Integration Point using API	| ${IntegrationPoint4}

| | Drop connection to the relativity services api
| | Close All Browsers


*** Settings ***
| Library	| ${KEYWORD_DIR}/kWebDriver.py
| Resource	| ${KEYWORD_DIR}/Relativity/Processing/Processing/Relativity_Keywords_General.txt
| Resource	| ${KEYWORD_DIR}/Relativity/Shared/Layouts/LayoutKeywords.txt
| Resource	| ${KEYWORD_DIR}/Relativity/Shared/RelativityKeywords.txt
| Resource	| ${LEGAL_HOLD_KEYWORD_DIR}/MiscLegalHoldKeywords.txt
| Resource	| ${LEGAL_HOLD_KEYWORD_DIR}/NavigationKeywords.txt
| Resource	| ${LDAP_KEYWORD_DIR}/DatabaseKeywords.txt
| Resource	| ${LDAP_KEYWORD_DIR}/IntegrationPointKeywords.txt