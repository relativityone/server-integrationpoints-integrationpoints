*** Settings ***
| Documentation     | Verify that Job History records are created when a Job is started via both Scheduled and Import Now jobs
| Metadata		    | Authors	| Daniel Oliver
| Force Tags		| in-progress | team.game_of_holds	| feature.integration_points
| Suite Setup		| Create Suite Setup Data
| Test Teardown 	| Run Keyword if Test Failed	| Capture Page Screenshot
| Suite Teardown	| Delete the Objects created in the Suite then Close All Browsers

*** Variables ***

| ${WorkspaceName}	          | LDAP Sync
| ${IntegrationName}          | JobHistory
| ${Custodian}                | History, Job
| ${Custodians Grid}		  | gbox_custodianGrid

*** Test Cases ***

| Import Now RIP imports generate a History record
| | [Documentation] | Verify that when a RIP import starts by using the Import Now button, that a History record is created.
| | ...				| [id] ee94095e-b932-11e4-88d4-90b11c6c5ae4
| | [Tags]          | manual  | automatable
| | Run Import Now on the Following Integration Point | ${IntegrationName}  
| | Go to the tab  | Job History
| | Set Filter  | Integration Point | ${IntegrationName}
| | Run the following manual steps:
| | ... | Expected Results:
| | ... | 1. Verify that there is a Job History object for ${IntegrationName} that was just run

| Scheduled RIP imports generate a History record
| | [Documentation] | Verify that when a Scheduled RIP import starts, that a History record is created.
| | ...				| [id] ec04abf0-b932-11e4-93a4-90b11c6c5ae4
| | [Tags]          | manual  | automatable
| | View Integration Point | ${IntegrationName}  
| | Run the following manual steps:
| | ... | Steps:
| | ... | 1. Edit the Integration Point
| | ... | 2. Allocate a schedule to run a few minutes from now
| | ... | 3. Save the Integration Point
| | ... | 4. Go to the tab  | Job History
| | ... | 5. Set Filter  | Integration Point | ${IntegrationName}
| | ... |
| | ... | Expected Results:
| | ... | 1. Verify that there is a Job History object for ${IntegrationName} that was just run

*** Keywords *** 

| Create Suite Setup Data
| | [Documentation]	| Create the Suite Preconditions
| | Setup connection to the relativity database
| | Open and Log in to Method
| | Setup connection to the Relativity Services API for Method	| ${WorkspaceName}

| | ${IntegrationPointExists}=	| Determine if the Following Integration Point Exists in the current Workspace	| ${IntegrationName}
| | Run Keyword If	| ${${IntegrationPointExists}}	| Delete the following Integration Point using API 	| ${IntegrationName}

| | @{Step1Fields}  | Create list | ${IntegrationName} | Append/Overlay |
| | ... | LDAP | Custodian | no
| | @{Step2Fields}  | Create list | gameofholds.testing.corp/CN=Users,DC=gameofholds,DC=testing,DC=corp | 
| | ... | (department=${IntegrationName}) | FastBind | testing\\rellockdown | P@ssw0rd@1
| | @{Step3Mapping}=	| Create List	|
| | ... | Email			| mail			| 
| | ... | Department	| department	| 
| | ... | First Name	| givenname		| 
| | ... | Last Name		| sn			| 
| | ... | UniqueID		| objectguid
| | Create Integration Point | ${Step1Fields} | ${Step2Fields} | ${Step3Mapping} | Email

| | [Teardown] | Drop connection to the relativity services api

| Delete the Objects created in the Suite then Close All Browsers
| | [Documentation]	| Delete the Suite test data of Integration Point and Custodians.
| | Setup connection to the Relativity Services API for Method	| ${WorkspaceName}

| | Delete the following Integration Point using API | ${IntegrationName}
| | Delete the Custodians in the Following Department using API	| ${IntegrationName}

| | Drop connection to the relativity services api
| | Close All Browsers

*** Settings ***
| Library	| Collections
| Library	| ${KEYWORD_DIR}/kWebDriver.py
| Resource	| ${KEYWORD_DIR}/Method/Method_Keywords_API.txt
| Resource	| ${METHOD_KEYWORD_DIR}/GridKeywords.txt
| Resource	| ${METHOD_KEYWORD_DIR}/MiscMethodKeywords.txt
| Resource	| ${METHOD_KEYWORD_DIR}/NavigationKeywords.txt
| Resource	| ${LDAP_KEYWORD_DIR}/IntegrationPointKeywords.txt
